// Troubleshooting Decision Trees and Common Issues

export const TROUBLESHOOTING = [
  {
    id: 'offline',
    symptom: 'Device offline in dashboard',
    icon: 'ðŸ“¡',
    severity: 'high',
    causes: [
      'Cellular signal lost or weak',
      'SIM card issue or deactivated',
      'Power failure (battery depleted)',
      'Antenna disconnected or damaged',
      'HAT communication failure',
    ],
    diagnosticSteps: [
      'Check Hologram dashboard for last connection time',
      'Review battery SoC trend in historical data',
      'Check for regional cellular outages',
      'Physical inspection: verify LED status pattern',
      'Check antenna connection at SMA connector',
    ],
    fixes: [
      { action: 'Relocate or add external antenna', difficulty: 'easy' },
      { action: 'Check solar panel / battery / LVD chain', difficulty: 'medium' },
      { action: 'Verify SIM activation in Hologram portal', difficulty: 'easy' },
      { action: 'Reseat HAT and antenna connector', difficulty: 'medium' },
      { action: 'Replace SIM card if damaged', difficulty: 'easy' },
    ],
  },
  {
    id: 'sensor-stuck',
    symptom: 'Sensor reading stuck or erratic',
    icon: 'ðŸ“Š',
    severity: 'medium',
    causes: [
      'Sensor probe fouled with algae/debris',
      'Probe failure (end of life)',
      'Cable damage or loose connection',
      'ADC module issue',
      'I2C bus communication error',
    ],
    diagnosticSteps: [
      'Compare reading to reference measurement (handheld meter)',
      'Check cable continuity with multimeter',
      'Review historical data for gradual drift vs sudden change',
      'Check I2C bus in diagnostics menu',
      'Inspect probe for physical damage',
    ],
    fixes: [
      { action: 'Clean probe with soft brush + distilled water', difficulty: 'easy' },
      { action: 'Recalibrate sensor with fresh standards', difficulty: 'medium' },
      { action: 'Replace probe (see maintenance schedule)', difficulty: 'medium' },
      { action: 'Replace sensor cable', difficulty: 'medium' },
      { action: 'Reseat I2C connectors on ADC and Pi', difficulty: 'medium' },
    ],
  },
  {
    id: 'ultrasonic-inactive',
    symptom: 'Ultrasonic not activating',
    icon: 'ðŸ”Š',
    severity: 'medium',
    causes: [
      'Relay failure (stuck open)',
      'Ultrasonic driver fault',
      'Insufficient power (battery too low)',
      'Schedule misconfigured in dashboard',
      'Inverter fault (solar units)',
    ],
    diagnosticSteps: [
      'Check treatment schedule in dashboard settings',
      'Listen for relay click at scheduled activation time',
      'Listen for 28kHz hum during treatment window',
      'Verify relay click manually via dashboard test',
      'Check inverter output voltage (solar units)',
    ],
    fixes: [
      { action: 'Adjust treatment schedule in dashboard', difficulty: 'easy' },
      { action: 'Test relay manually; replace if failed', difficulty: 'medium' },
      { action: 'Check inverter AC output (118-122V)', difficulty: 'medium' },
      { action: 'Replace ultrasonic driver/transducer', difficulty: 'hard' },
      { action: 'Verify LVD not tripping during activation', difficulty: 'medium' },
    ],
  },
  {
    id: 'battery-not-charging',
    symptom: 'Battery not charging',
    icon: 'ðŸ”‹',
    severity: 'high',
    causes: [
      'Solar panel shading or soiling',
      'MPPT controller fault',
      'BMS lockout (over-temp or over-voltage)',
      'Wiring issue (MC4 or terminal)',
      'Panel damage (cracked cells)',
    ],
    diagnosticSteps: [
      'Check panel voltage: should be >18V (12V system) or >28V (24V) in sun',
      'Review MPPT status lights / Bluetooth app',
      'Check battery BMS indicators',
      'Inspect MC4 connections for damage/corrosion',
      'Verify no shading from 9AM-3PM',
    ],
    fixes: [
      { action: 'Clean solar panel with soft cloth + water', difficulty: 'easy' },
      { action: 'Verify MPPT configuration (battery type, voltage)', difficulty: 'medium' },
      { action: 'Reset BMS by disconnecting battery briefly', difficulty: 'medium' },
      { action: 'Repair or replace MC4 connectors', difficulty: 'medium' },
      { action: 'Replace damaged solar panel', difficulty: 'hard' },
    ],
  },
  {
    id: 'gps-drift',
    symptom: 'GPS position drifting (buoys)',
    icon: 'ðŸ“',
    severity: 'medium',
    causes: [
      'Anchor dragging (insufficient holding)',
      'Mooring line stretched or broken',
      'GPS antenna issue',
      'Strong current or weather event',
    ],
    diagnosticSteps: [
      'Review GPS track history (24-48 hours)',
      'Check weather conditions during drift period',
      'Determine if drift was gradual or sudden',
      'Check mooring line tension on next visit',
    ],
    fixes: [
      { action: 'Re-anchor with heavier anchor', difficulty: 'hard' },
      { action: 'Replace mooring line (3:1 scope minimum)', difficulty: 'hard' },
      { action: 'Add second anchor in high-current areas', difficulty: 'hard' },
      { action: 'Check GPS antenna mounting', difficulty: 'medium' },
    ],
  },
  {
    id: 'ph-drift',
    symptom: 'pH reading drifting over time',
    icon: 'âš—ï¸',
    severity: 'low',
    causes: [
      'Probe needs calibration (normal)',
      'Reference electrolyte depleted',
      'Probe junction fouled',
      'Temperature compensation error',
      'Probe end of life',
    ],
    diagnosticSteps: [
      'Compare to handheld pH meter',
      'Check last calibration date',
      'Inspect probe for visible fouling',
      'Check temperature reading accuracy',
      'Review probe age (12-18 month lifespan)',
    ],
    fixes: [
      { action: 'Perform 2-point calibration (pH 4.0 + 7.0)', difficulty: 'easy' },
      { action: 'Clean probe with dilute HCl (10%)', difficulty: 'easy' },
      { action: 'Replace reference electrolyte (refillable probes)', difficulty: 'medium' },
      { action: 'Replace probe (if >12 months old)', difficulty: 'medium' },
    ],
  },
  {
    id: 'high-power',
    symptom: 'Higher than expected power consumption',
    icon: 'âš¡',
    severity: 'low',
    causes: [
      'Fan running continuously (high ambient temp)',
      'Relay stuck on',
      'Short circuit in wiring',
      'Ultrasonic running too frequently',
      'LTE modem in constant retry mode',
    ],
    diagnosticSteps: [
      'Review power consumption in dashboard',
      'Check ambient temperature (fan activation)',
      'Listen for relay clicks (should be intermittent)',
      'Review ultrasonic schedule (default: 15min every 6hr)',
      'Check cellular signal strength',
    ],
    fixes: [
      { action: 'Adjust fan hysteresis thresholds', difficulty: 'medium' },
      { action: 'Replace stuck relay', difficulty: 'medium' },
      { action: 'Reduce ultrasonic frequency if acceptable', difficulty: 'easy' },
      { action: 'Improve antenna placement for better signal', difficulty: 'medium' },
      { action: 'Inspect wiring for shorts', difficulty: 'hard' },
    ],
  },
  {
    id: 'led-red-blink',
    symptom: 'Red LED blinking rapidly',
    icon: 'ðŸ”´',
    severity: 'high',
    causes: [
      'Critical system error',
      'Sensor communication failure',
      'SD card read/write error',
      'Python script crash',
    ],
    diagnosticSteps: [
      'Check dashboard for error messages',
      'Review system logs if accessible',
      'Power cycle the device',
      'Check SD card integrity',
    ],
    fixes: [
      { action: 'Power cycle device (wait 30 seconds)', difficulty: 'easy' },
      { action: 'Re-seat SD card', difficulty: 'easy' },
      { action: 'Re-flash SD card with latest firmware', difficulty: 'medium' },
      { action: 'Contact support if persists', difficulty: 'easy' },
    ],
  },
];

// LED Status Code Reference (expanded)
export const LED_STATUS_CODES = [
  { pattern: '1 blink / 2 sec', color: 'green', meaning: 'Booting', action: 'Wait 60-90 seconds', duration: 'Boot only' },
  { pattern: '2 blinks / 2 sec', color: 'green', meaning: 'Connecting to cellular', action: 'Wait 2 min; check SIM if persists', duration: 'Up to 3 min' },
  { pattern: '3 blinks / 2 sec', color: 'green', meaning: 'Online and operational', action: 'Normal - no action needed', duration: 'Continuous' },
  { pattern: 'Solid ON', color: 'blue', meaning: 'Ultrasonic active', action: 'Normal during 15-min treatment', duration: '15 min' },
  { pattern: 'Rapid blink (5/sec)', color: 'red', meaning: 'Error condition', action: 'Check dashboard for details', duration: 'Until resolved' },
  { pattern: '1 long, 2 short', color: 'amber', meaning: 'Low battery warning', action: 'Check solar/charging system', duration: 'Until charged' },
  { pattern: 'OFF', color: 'none', meaning: 'No power or deep sleep', action: 'Check power, battery, LVD', duration: 'N/A' },
  { pattern: 'Alternating G/A', color: 'green/amber', meaning: 'Firmware update', action: 'Do NOT power off - wait', duration: '5-15 min' },
  { pattern: 'Slow pulse (1Hz)', color: 'green', meaning: 'Normal heartbeat', action: 'None - healthy status', duration: 'Continuous' },
  { pattern: '1 blink / 5 sec', color: 'red', meaning: 'Sensor error', action: 'Check specific sensor in dashboard', duration: 'Until fixed' },
];

// LED Color hex values
export const LED_COLORS_HEX = {
  green: '#22c55e',
  red: '#ef4444',
  amber: '#f59e0b',
  blue: '#3b82f6',
  'green/amber': '#84cc16',
  none: '#475569',
};

export default { TROUBLESHOOTING, LED_STATUS_CODES, LED_COLORS_HEX };
